{% extends "base.html" %}

{% block body_class %}page-auth-reset-password{% endblock %}

{% block content %}

{% include "includes/main_title.html" %}

<p>{{ translate('Password should be at least 8 characters long') }}</p>

<form method="post" action="/auth/reset-password/{{ token }}">
    <input type="password" name="password" placeholder="{{ translate('Password') }}" aria-label="Login" autocomplete="email"
        required>
    <input type="password" name="password_2" placeholder="{{ translate('Repeat Password') }}" aria-label="Login" autocomplete="email"
        required>

    <input type="hidden" name="token" value="{{ token }}">
    <button type="submit" class="contrast">{{ translate('Update Password') }}</button>
</form>
<div class="loadingspinner hidden"></div>
<script type="module" nonce="{{ request.state.csp_nonce }}">

    import { asyncLogError } from "/static/js/error.js";
    import { Requests } from "/static/js/requests.js";
    import { Flash } from "/static/js/flash.js";
    import { config } from "/static/js/config.js";

    const spinner = document.querySelector('.loadingspinner');
    const form = document.querySelector('form');
    form.addEventListener('submit', async function(event) {

        event.preventDefault();
        spinner.classList.toggle('hidden');

        try {
            const url = form.action;
            const formData = new FormData(form);
            const res = await Requests.asyncPost(url, formData);

            if (res.error) {
                Flash.setMessage(res.message, 'error');
            } else {
                window.location.href = res.redirect
            } 
            
        } catch (e) {
            Flash.setMessage(config.jsExceptionMessage, 'error');
            asyncLogError(e);
            console.error(e);
        } finally {
            spinner.classList.toggle('hidden');
        }
    });
</script>

{% endblock content %}