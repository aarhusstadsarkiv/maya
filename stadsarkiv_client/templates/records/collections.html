{% extends "base.html" %}

{% macro parse_node(node) %}
{% set label = node.label|trim %}
{% set series = node.path|urlencode%}
{% if not label %}
{% set label = "Ingen titel" %}
{% endif %}
<a href="/search?collection={{ collection['id'] }}&series={{ series }}">{{ label }}</a>
{% endmacro %}

{% macro parse_tree(nodes) %}
    <ul>
    {% for node in nodes %}
        <li>
            {% if node.children %}
                <details>
                    <summary>{{ parse_node(node) }}</summary>
                    {{ parse_tree(node.children) }}
                </details>
            {% else %}
                {{ parse_node(node) }}
            {% endif %}
        </li>
    {% endfor %}
    </ul>
{% endmacro %}

{% macro parse_string_list (title, value) %}
{% if collection[value] %}
<div class="record-content">
    <div class="label">
        {{ title }}
    </div>
    <div class="content">
        {% for item in collection[value] %}
        <p>{{ item|safe }}</p>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endmacro %}

{% macro parse_section(title, section) %}
{% if collection[section] %}
    <div class="record-content">
        <div class="label">
            {{ title }}
        </div>
        <div class="content">
            {{ paragraphs(collection[section])|safe }}
        </div>
    </div>
{% endif %}
{% endmacro %}

{% macro parse_link_list(title, section) %}
{% if collection[section] %}
<div class="record-content">
    <div class="label">
        {{ title }}
    </div>
    <div class="content">
        {% for source in collection[section] %}
        <p>
            <a href="{{ source }}">{{ urldecode(source)|truncate(40) }}</a>
        </p>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endmacro %}

{% macro parse_slideshow(images) %}
<div class="slideshow-container">
    {% for image in images %}
    <div class="slide">
        <img src="{{ image }}" alt="Slide {{ loop.index }}">
    </div>
    {% endfor %}

    <a href="#" class="prev">&#10094;</a>
    <a href="#" class="next">&#10095;</a>

    <div class="slide-counter">
        <span class="current-slide"></span> / <span class="total-slides"></span>
    </div>
</div>
<script type="module">
    import { } from "/static/js/slideshow.js";
</script>
{% endmacro %}

{% macro parse_abstract() %}
<div class="record-main">
    <div>
        {# collectors, curators, date_from, date_to, bulk_years, extent #}
        {{ parse_string_list("Test", 'collectors') }}
    </div>
</div>
{% endmacro %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/collections.css') }}?v={{ get_setting('version') }}">
<link rel="stylesheet" href="{{ url_for('static', path='/css/slideshow.css') }}?v={{ get_setting('version') }}">
{% endblock head %}

{% block content %}

{% include "includes/main_title.html" %}

<div class="record-section">
    <div class="record-representation">
    {% if collection['has_highlights'] %}
    {{ parse_slideshow(collection['highlights'])}}
    {% endif %}
    </div>
    <div class="record-main">
    {{ parse_abstract() }}
    </div>
</div>

<p>
    <a href="/search?collection={{ collection['id'] }}">Vis alle resultater i samlingen</a>
</p>

{% if collection['has_abstract'] %}
<div class="record-main">
<h3 class="record-header">Abstrakt</h3>
{{ parse_section('Abstrakt', 'summary')}}
{{ parse_section('Beskrivelse', 'description')}}
{{ parse_section('Opbygning', 'content_and_scope')}}
</div>
{% endif %}

{% if collection['has_access_usage'] %}
<div class="record-main">
<h3 class="record-header">Tilgængelighed og brug</h3>
{{ parse_section('Tilgængelighed', 'access')}}
{{ parse_section('Juridiske forhold', 'legal_status')}}
{{ parse_section('Digitalisering', 'level_of_digitisation')}}
{{ parse_section('Citation', 'citation')}}
</div>
{% endif %}

{% if collection['has_provenance'] %}
{% endif %}

{% if collection['has_history'] %}
<div class="record-main">
<h3 class="record-header">Afleveringshistorik</h3>
{{ parse_section('Afleveringshistorik', 'custodial_history')}}
{{ parse_section('Kassation', 'level_of_kassation')}}
{{ parse_section('Indkomstens status', 'accrual_status')}}
</div>
{% endif %}

{% if collection['has_literature'] %}
<div class="record-main">
<h3 class="record-header">Litteratur</h3>
{{ parse_section('Kassation', 'level_of_kassation')}}
{{ parse_link_list('Litteratur', 'sources')}}
</div>
{% endif %}

{% if collection['has_series'] %}
<div class="record-main">
<h3 class="record-header">Arkivserier</h3>
<p>
    Browse i samlingens serier. Klik på en given serie for at se, hvilke materialer, der er placeret her
</p>
{{ parse_tree (collection['series']) }}
</div>
{% endif %}

{% if collection['has_collection_tags'] %}
<div class="record-main">
<h3 class="record-header">Samlingstags</h3>
<p>
    Browse i samlingens tags. Klik på et tag for at se, hvilke materialer, der er opmærket med dette.
</p>
{{ parse_tree (collection['collection_tags']) }}
</div>
{% endif %}

<div class="record-main">
<h3 class="record-header">Metadata</h3>
<p><a href="/collections/{{ collection['id'] }}/json">JSON</a></p>
</div>
{% endblock content %}