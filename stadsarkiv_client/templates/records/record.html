{% set azure_allow_media_search = "sp=r&st=2023-02-03T12:19:05Z&se=2030-04-01T19:19:05Z&spr=https&sv=2021-06-08&sr=c&sig=QK9mOWt0oZ%2FtiY5biruFo0eGPirtjHYEQ061tPuZYHU%3D" %}

{% import "macros/common_macros.html" as common_macros %}

{% macro parse_record_pagination(record_pagination) %}
{% if record_pagination %}
<div class="record-pagination">
    <div class="record-search-link">
        <a href="/search?{{ record_pagination['query_str_display'] }}">{{translate('Latest search') }}</a> 
    </div>
    <div class="record-pages-info">
        ({{ translate ('Page') }} {{ record_pagination["current_page"] }} / {{ record_pagination["total"] }})
    </div>
    <div class="record-prev-next">
        {% if record_pagination.prev_record is none %}
        <span class="disabled">&lt;</span>
        {% else %}
        <a class="prev" href="/records/{{ record_pagination.prev_record }}?search={{ record_pagination.prev_page }}">&lt;</a>
        {% endif %}
        {% if record_pagination.next_record is none %}
        <span class="disabled">&gt;</span>
        {% else %}
        <a class="next" href="/records/{{ record_pagination.next_record }}?search={{ record_pagination.next_page }}">&gt;</a>
        {% endif %}
        
    </div>
</div>
{% endif %}
{% endmacro %}

{% macro _parse_representations_media(meta_data) %}
{% if meta_data["record_type"] == 'image' %}
    <img class="record-image" src="{{meta_data['portrait']}}" alt="{{ translate('Image') }}" />
    <div class="overlay overlay-hidden">
        <img id="overlay-image" src="{{meta_data['representations']['large_image']}}" alt="{{ translate('Large Image') }}">
    </div>
{% endif %}

{% if meta_data["record_type"] == 'video' %}
<video controls="" poster="{{ meta_data.representations.get('record_image') }}" preload="metadata">
    <source src="{{ meta_data.representations.get('record_file') }}?{{ azure_allow_media_search }}" type="video/mp4" />
    <p>This browser doesn't support video tag.</p>
</video>
{% endif %}

{% if meta_data["record_type"] == 'audio' %}
<figcaption>{{ translate('Click in order to listen to the audio.') }}</figcaption><br />
<audio controls="" preload="metadata">
    <source src="{{ meta_data.representations.get('record_file') }}?{{ azure_allow_media_search }}" type="audio/mpeg" />
    <p>This browser doesn't support the audio tag.</p>
</audio>
{% endif %}

{% if meta_data["record_type"] == 'web_document' %}
<a href="{{meta_data.representations.get('web_document_url')}}">
    <img src="{{meta_data.portrait}}" alt="{{ section }}" />
</a>
<p>
    {{ translate('Click on the image to open the PDF document.') }}
</p>
{% endif %}

{% if meta_data["record_type"] == 'sejrs_sedler' %}
<div class="record-sejrs-sedler">{{ meta_data['representation_text']|trim }}</div>
{% endif %}
{% endmacro %}

{% macro _parse_representations_block(meta_data) %}
<div class="record-representation">
{% if meta_data["is_representations_online"] %}
{{ _parse_representations_media(meta_data)}}
{% elif meta_data["availability_id"] == 3 %}
{{ common_macros.parse_icon('lock', translate('The material is available in the reading room.'))}}
{% elif meta_data["availability_id"] == 2 %}
{{ common_macros.parse_icon('lock', translate('The material can be order home to the reading room.'))}}
{% endif %}
</div>
{% endmacro %}

{% macro _parse_representation_block(meta_data) %}
{% if meta_data["has_representations"] %}
{{ _parse_representations_block(meta_data) }}
{% else %}
<div class="record-representation">
    {{ common_macros.parse_icon(meta_data["icon"]["icon"], meta_data["icon"]["label"]) }}
</div>
{% endif %}
{% endmacro %}

{% macro parse_block_first(block_keys, meta_data, record_and_types) %}
{% if key_exist_in_dict(block_keys, record_and_types) %}
<div class="record-section">
    {{ _parse_representation_block(meta_data) }}

    <div class="record-main">
        {% if meta_data["title"] %}
        <div class="record-title">{{ meta_data["title"] }}</div>
        {% endif %}
        {% for key in block_keys %}
        {% if key in record_and_types %}
        {{ common_macros.parse_block_section(record_and_types[key]) }}
        {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}
{% endmacro %}

{% extends "base.html" %}

{% block body_class %}page-records-view{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/overlay.css') }}?v={{ get_setting('version') }}">
<script type="module">
    import {  } from "/static/js/record.js";
    import { activateOverlay } from "/static/js/overlay.js";
    activateOverlay('.record-representation');
</script>
{% endblock head %}

{% block content %}

{{ parse_record_pagination(record_pagination) }}

{% set keys = ["collectors", "content_types", "creators", "date_normalized", "curators", "id"] %}
{{ parse_block_first(keys, meta_data, record_and_types) }}
{% set keys = ["heading", "summary", "desc_notes", "collection", "series", "collection_tags", "subjects" ] %}
{{ common_macros.parse_block_common('Beskrivelse', keys, record_and_types) }}
{% set keys = ["copyright_status_normalized"] %}
{{ common_macros.parse_block_common('Ophavsret', keys, record_and_types) }}
{% set keys = ["desc_data"] %}
{{ common_macros.parse_block_common('Beskrivelsesdata', keys, record_and_types) }}
{% set keys = ["locations", "organisations", "events", "people", "objects"] %}
{{ common_macros.parse_block_common('Relationer', keys, record_and_types) }}
{% set keys = ["rights_notes"] %}
{{ common_macros.parse_block_common('Rettighedsnoter', keys, record_and_types) }}
{% set keys = ["contractual_status_normalized", "other_legal_restrictions_normalized"] %}
{{ common_macros.parse_block_common('Anden juridisk beskyttelse', keys, record_and_types) }}
{% set keys = ["availability_normalized"] %}
{{ common_macros.parse_block_common('Tilgængelighed', keys, record_and_types) }}
{% set keys = ["ordering_normalized"] %}
{{ common_macros.parse_block_common('Bestilling', keys, record_and_types) }}
{% set keys = ["admin_notes", "admin_data", "registration_id", "created_by", "created", "last_updated_by", "last_updated"] %}

{% if is_employee %}
{{ common_macros.parse_block_common('Administration', keys, record_and_types) }}
{% set keys = ["resources"] %}
{{ common_macros.parse_block_common('Resourcer', keys, record_and_types) }}
{% endif %}

{% set keys = ["representations"] %}
{{ common_macros.parse_block_common('Download', keys, record_and_types) }}

{% set meta_links = [
    {"url": "/records/" + meta_data['id'] + "/json/record", "label": "JSON fra API efter hooks" },
    {"url": "/records/" + meta_data['id'] + "/json/meta_data", "label": "JSON som indeholder meta data" },
    {"url": "/records/" + meta_data['id'] + "/json/record_and_types", "label": "JSON med typer tilføjet."}
] 
%}

{% set meta_links = [
    {'label': 'JSON. Record fra API efter hooks', 'url': url_for('proxies_records_get_json', record_id=meta_data.id, type='record') | string},
    {'label': 'JSON. Metadata', 'url': url_for('proxies_records_get_json', record_id=meta_data.id, type='meta_data') | string},
    {'label': 'JSON. Typer og værdier', 'url': url_for('proxies_records_get_json', record_id=meta_data.id, type='record_and_types') | string}
] %}

{{ common_macros.parse_meta_block(meta_links) }}

{% endblock content %}