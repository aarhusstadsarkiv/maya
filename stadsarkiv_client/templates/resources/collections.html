{% import "macros/common_macros.html" as common_macros %}
{% import "macros/slideshow_macros.html" as slideshow_macros %}

{% macro _parse_node(node) %}
{% set label = node.label|trim %}
{% set series = node.path|urlencode%}
{% if not label %}
{% set label = "Ingen titel" %}
{% endif %}
<a href="/search?collection={{ collection['id_real'] }}&series={{ series }}">{{ label }}</a>
{% endmacro %}

{% macro parse_tree(nodes) %}
    <ul>
    {% for node in nodes %}
        <li>
            {% if node.children %}
                <details>
                    <summary>{{ _parse_node(node) }}</summary>
                    {{ parse_tree(node.children) }}
                </details>
            {% else %}
                {{ _parse_node(node) }}
            {% endif %}
        </li>
    {% endfor %}
    </ul>
{% endmacro %}

{% extends "base.html" %}

{% block body_class %}page-resources-collections{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/collections.css') }}?v={{ get_setting('version') }}">
<link rel="stylesheet" href="{{ url_for('static', path='/css/slideshow.css') }}?v={{ get_setting('version') }}">
{% endblock head %}

{% block content %}

{% include "includes/main_title.html" %}

<p>
    <a href="/search?collection={{ collection['id_real'] }}">{{ translate('Show all results in the collection') }}</a>
</p>

{% set keys = ['collectors', 'curators', 'outer_years', 'bulk_years', 'extent'] %}
{{ slideshow_macros.parse_slideshow_block_first(keys, collection, 'highlights') }}

{% set keys = ["summary", "description", "content_and_scope"] %}
{{ common_macros.parse_block_common('Abstrakt', keys, collection) }}

{% set keys = ["access", "legal_status", "level_of_digitisation", 'citation', 'associated_material'] %}
{{ common_macros.parse_block_common('Tilgængelighed og brug', keys, collection) }}

{% set keys = ["custodial_history", "accumulation_range", "level_of_kassation", "accrual_status"] %}
{{ common_macros.parse_block_common('Afleveringshistorik', keys, collection) }}

{% set keys = ["sources_normalized"] %}
{{ common_macros.parse_block_common('Literatur og kilder', keys, collection) }}

{% set keys = ["series"] %}
{% if key_exist_in_dict(keys, collection) %}
<div class="record-section">
    <div class="record-main">
    <h3 class="record-header">Arkivserier</h3>
    <p>
        Browse i samlingens serier. Klik på en given serie for at se, hvilke materialer, der er placeret her
    </p>
    {{ parse_tree (collection['series']) }}
    </div>
</div>
{% endif %}

{% set keys = ["collection_tags"] %}
{% if key_exist_in_dict(keys, collection) %}
<div class="record-section">
    <div class="record-main">
    <h3 class="record-header">Samlingstags</h3>
    <p>
        Browse i samlingens tags. Klik på et tag for at se, hvilke materialer, der er opmærket med dette.
    </p>
    {{ parse_tree (collection['collection_tags']) }}
    </div>
</div>
{% endif %}

{% set meta_links = [{"url": "/collections/" + collection['id_real'] + "/json", "label": "JSON" }] %}
{{ common_macros.parse_meta_block(meta_links) }}

{% endblock content %}