# Client

A custom client is generated by overriding `templates`, `static` files, `.env`, and `settings` files. E.g. it may look something like this:

    example-config-simple
    ├── .env
    ├── hooks.py
    ├── language.py
    ├── settings_facets.py
    ├── settings.py
    ├── static
    │   ├── css
    │   │   └── local.css
    │   └── js
    │       ├── home.js
    │       └── local.js
    └── templates
        ├── auth
        │   └── login.html
        ├── includes
        │   └── head_extra.html
        └── pages
            ├── collections.html
            ├── home.html
            └── searchguide.html

The above structure shows the `example-config-simple` client. You may use this client as a starting point. You can browse the files of the client by visiting this link: [example-config-simple](https://github.com/aarhusstadsarkiv/stadsarkiv-client/tree/main/example-config-simple).

Run the client:

```bash
stadsarkiv-client server-dev -c example-config-aarhus
```

If the `-c` or `--config` option is not used, then the module will look for templates, static files, and configuration in the folder `local`. If the `local` does not exist, the module will use built-in defaults.

## .env

In `.env` you may set the following:

```ini
# SESSION Secret
SECRET=some_secret

# development or production
# If ENVIRONMENT is set to production, the log level is INFO
# If ENVIRONMENT is set to development, the log level is DEBUG
ENVIRONMENT=development
```

You may generate a new secret using the following command:

```bash
stadsarkiv-client server-secret
```

## language.py

In `language.py` you may override translations:

```python
# This file overrides translation keys.
language = {
    "Forgot your password": "Har du glemt dit kodeord?",
}
```

Original language files (and keys) can be found in [stadsarkiv_client/locales/da.py](/stadsarkiv_client/locales/da.py)

## Templates

### Override

Templates that you can override can be found in the [stadsarkiv_client/templates](/stadsarkiv_client/templates) directory. In order to override a template you place your custom template in the `templates` directory. In the `example-config-simple` there is a override of `auth/login.html` and `pages/home.html`.

As you can see in the home.html template, you may add custom css and js files in the `head` block. This is done like this:

```html
{% block head %}
<script src="{{ url_for('static', path='/js/home.js') }}"></script>
{% endblock head %}
```

The above code adds custom css and js files to the `head` block of any individual template.

You may also add custom css and js files to the `head` block of all templates. This is done by overriding `templates/includes/head_extra.html`. In the `example-config-simple` there is a custom `head_extra.html` file that just adds a log message to the browser console.

An easy way to alter the footer is to override the `templates/includes/footer.html`.

### Custom pages

You may add custom pages. In the `example-config-simple` there is a custom page `searchguide.html`. You may add custom pages anywhere in the `templates` directory. In the above example the custom page is placed in `templates/pages/searchguide.html`.

## Static files

### Override

You may also override any static file found in [stadsarkiv_client/static](/stadsarkiv_client/static)

E.g. if you only want to alter the `logo` and the `favicon` you need to create a `static/assets/default_logo.png` and `static/assets/favicon.ico` in your `example-config-simple` directory.

If you just want to change the color scheme you can create a `static/assets/css/light.css` file. Here are all the colors of the default theme defined. You may override any of them.

An easy way to add custom css and js is just to create a `static/assets/css/local.css` and `static/assets/js/local.js` file. These files are loaded in the base templates if they exist. The css file is loaded as the last css file in the `head` block. The js file is loaded as the last js file in the `head` block.

## Settings

```py
import typing


settings: dict[str, typing.Any] = {
    # This should be the name of the client, e.g. "aarhusarkivet"
    #
    # If you are running in production, you should change this to the name of your client
    # If you are running in development, you can leave it as "development"
    "client_name": "development",
    # This should be the url of the client, e.g. "https://aarhusarkivet.openaws.dk"
    # If running on localhost you may change this to e.g. "http://localhost:5555"
    "client_url": "https://client.openaws.dk",
    # If you are running in production, you may set this to True in order to allow robots to index the site
    "robots_allow": False,
    # show the version of the stadarkiv-client
    "show_version": True,
    # only supported language is "da" for now
    "language": "da",
    # log handlers can be "stream", "rotating_file"
    # on development you can use "stream" to see logs in the console
    "log_handlers": ["stream", "rotating_file"],  # [ "stream", "file", "rotating_file"]
    # cookie settings. These settings are reasonable defaults
    "cookie": {
        "name": "session",
        "lifetime": 3600,  # seconds
        "httponly": True,
        "secure": True,
        "samesite": "lax",
    },
    # Set a 500 custom error message
    "custom_error": "Der skete en system fejl. Prøv igen lidt senere!",
    # Is you are running in production, you should change the api_base_url to the production API.
    # production "api_base_url": "https://api.openaws.dk/v1",
    "api_base_url": "https://dev.openaws.dk/v1",
    # Main menu containing built-in endpoints, but you may remove these and generate your own menu.
    # You may also add other "menus", e.g. "footer_items" or something similar.
    #
    "main_menu": [
        {"name": "auth_login_get", "title": "Log ind", "type": "dropdown"},
        {"name": "auth_logout_get", "title": "Log ud", "type": "dropdown"},
        {"name": "auth_register_get", "title": "Ny bruger", "type": "dropdown"},
        {"name": "auth_me_get", "title": "Profil", "type": "dropdown"},
        {"name": "admin_users_get", "title": "Brugere", "type": "dropdown"},
        {"name": "schemas_get_list", "title": "Skemaer", "type": "dropdown"},
        {"name": "entities_get_list", "title": "Entiteter", "type": "dropdown"},
        {"name": "search_get", "title": "Søg", "type": "top"},
    ],
    # The facets enabled in the search
    # These are the defaults: ["content_types", "subjects", "availability", "usability", "dates"]
    # The facets are loaded from 'settings_facets.py'
    "facets_enabled": ["content_types", "events", "dates"],
    # CORS allow origins
    "cors_allow_origins": [],
    # Allow user registration
    "allow_user_registration": True,
    # Allow user management
    "allow_user_management": True,
    # Allow online ordering
    "allow_online_ordering": False,
    # Ignore record keys so that the will not be displayed in the record template
    "ignore_record_keys": [],
}

# pages
#
# "name" is the route name. Title is the page title.
# "template" if the page you will use. It is also the content of the page.
# "url" is the path to the page
# "type" is the type of menu item. It can be "top" or "dropdown".
#  If it is not set, it will not be displayed in the top bar menu.

pages: list = [
    {"name": "home", "title": "Hjem", "template": "pages/home.html", "url": "/"},
]

pages_guides: list = [
    {
        "name": "page_searchguide",
        "title": "Hjælp til søgning",
        "template": "pages/searchguide.html",
        "url": "/guides/searchguide",
        "type": "dropdown",
    },
]

pages_about: list = [
    {
        "name": "page_collections",
        "title": "Om samlingerne",
        "template": "pages/collections.html",
        "url": "/about/collections",
        "type": "dropdown",
    },
]

settings["pages"] = pages + pages_guides + pages_about

# Add pages as sections in the main menu
settings["main_menu_sections"] = [
    {"name": "guides", "title": "Vejledninger", "pages": pages_guides},
    {"name": "about", "title": "Om samlingerne", "pages": pages_about},
]
```


